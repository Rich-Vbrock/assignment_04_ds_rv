---
title: "assignment_04_rmd"
author: "Richard Viebrock"
date: "11/11/2019"
output: html_document
---

### Part I

First, set echo to false. Make sure no messages are showing in final knitted document.

# Having trouble knitting document. WHY?

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}

# ---------------------------
# Install & Attach Packages
# ---------------------------

install.packages("directlabels")

library(tidyverse)
library(janitor)
library(directlabels)
library(DT)

# -----------------------------------
# Read-in & clean-up lobster data csv 
# -----------------------------------

lobster_abundance <- read_csv("lobster_abundance_sbc_lter.csv",
                              na = "-99999")%>%
  clean_names()

```

### In text (above or below the graph for Results A), describe general / interesting trends that you observe for lobster abundance at the 5 sites

```{r}
# --------------------------------
# Create data frame for ggplot
# --------------------------------

lobster_changes <- lobster_abundance %>%
  select(year, site, count) %>% 
  group_by(site, year) %>% 
  summarize(total_count = sum(count)) %>% 
  mutate(site_status = ifelse(site == "IVEE", "MPA",
         ifelse(site == "NAPL", "MPA", "Non-MPA"))) %>% 
  mutate(site_name = ifelse(site == "IVEE", "Isla Vista",
                            ifelse(site == "CARP", "Carpinteria",
                                   ifelse(site == "AQUE", "Arroyo Quemado", 
                                          ifelse(site == "NAPL", "Naples", "Mohawk")))))

```

```{r}
# ----------------------------
# Make a beautiful GGplot
# ----------------------------

ggplot(lobster_changes, aes(x = year, y = total_count, group = site))+
  geom_line(aes(color = site_status), size = 1.5)+
  geom_point(color = "gray35")+
  geom_dl(aes(label = site_name, color = site_status), method = list(dl.combine("last.points"), cex = 0.85))+
  scale_x_continuous(expand = c(0, 0),
                     limits = c(2012, 2019.25),
                     breaks = seq(2012, 2018, by = 1))+
  scale_y_continuous(limits = c(0, 1000),
                     expand = c(0,0),
                     breaks = seq(0, 1000, by = 250))+
    labs(color = "Marine Protected Area (MPA)",
         x = "Year",
         y = "Total Count (Number)",
         title = "Lobster Count by Year (Segan & Vieborck)")+
  theme(legend.position = c(0.2, 0.8),
        legend.background = element_rect(fill = "gray75"),
        legend.key = element_rect(fill = "gray85"))

# ----------------------------------------
# **Add a figure caption below the graph**
# ----------------------------------------

```

### Part 2

### In text, describe general / interesting trends that you see in community size structure at different sites (again, considering MPA vs. non-MPA status) for lobsters between 2012 and 2018. 

```{r}

# --------------------------------------------------
# Create a GGplot with two box-plots side-by-side
# --------------------------------------------------

lobster_sizes <- lobster_abundance %>%
  uncount(count) %>% 
  select(size_mm, year, site) %>% 
  mutate(site_name = ifelse(site == "IVEE" & year == "2018", "Isla Vista (2018)",
                            ifelse(site == "IVEE" & year == "2012", "Isla Vista (2012)",
                                   ifelse(site == "NAPL" & year == "2018", "Naples (2018)",
                                          ifelse(site == "NAPL" & year == "2012", "Naples (2012)",
                                                 ifelse(site == "CARP" & year == "2018", "Carpinteria (2018)",
                                                        ifelse(site == "CARP" & year == "2012", "Carpinteria (2012)",
                                                               ifelse(site == "AQUE" & year == "2018", "Arroyo Quemado (2018)",
                                                                      ifelse(site == "AQUE" & year == "2012", "Arroyo Quemado (2012)",
                                                                             ifelse(site == "MOHK" & year == "2018", "Mohawk (2018)", "Mohawk (2012)")))))))))) 
# GGPlot Time
                              
ggplot(data = lobster_sizes, aes(x = site_name, y = size_mm, color = site_name, fill = site_name))+
  geom_boxplot(show.legend = FALSE, alpha = 0.60)+
  scale_color_manual(values = c("dodgerblue", "dodgerblue", "red", "red", "purple", "purple", "orange", "orange", "green", "green"))+
  scale_fill_manual(values = c("dodgerblue", "dodgerblue", "red", "red", "purple", "purple", "orange", "orange", "green", "green"))+
  labs(x = "Site Name",
       y = "Spiny Lobster Size (mm)",
       title = "Size Comparison (Segan & Viebrock")+
  scale_x_discrete(labels = c(
    "Isla Vista (2018)" = "IV '18",
    "Isla Vista (2012)" = "IV '12",
    "Naples (2018)" = "NPLS '18",
    "Naples (2012)" = "NPLS '12",
    "Carpinteria (2018)" = "CARP '18",
    "Carpinteria (2012)" = "CARP '12",
    "Arroyo Quemado (2018)" = "AQUE '18",
    "Arroyo Quemado (2012)" = "AQUE '12",
    "Mohawk (2018)" = "MOHK '18",
    "Mohawk (2012)" = "MOHK '12"))+
  theme_light()

# OR

ggplot(data = lobster_sizes, aes(x = site_name, y = size_mm, color = site_name, fill = site_name))+
  geom_boxplot(show.legend = FALSE, alpha = 0.60)+
  scale_color_manual(values = c("dodgerblue", "dodgerblue", "red", "red", "purple", "purple", "orange", "orange", "green", "green"))+
  scale_fill_manual(values = c("dodgerblue", "dodgerblue", "red", "red", "purple", "purple", "orange", "orange", "green", "green"))+
  labs(x = "Site Name",
       y = "Spiny Lobster Size (mm)",
       title = "Spiny Lobster Size Comparison: 2012 vs. 2018")+
  theme_light()+
  coord_flip()

# ----------------------------------------
# **Add a figure caption below the graph**
# ----------------------------------------

```

### Part 3

### In text in your report, describe the outcome of the statistical hypothesis tests using in-line referencing (e.g. do not copy and paste values from the output). Remember: the p-value is not enough. You should also describe more meaningful metrics for comparison. Here are some things you might consider including in your description: the actual differences in mean size between groups, % changes, measure of uncertainty (e.g. confidence interval), etc.

```{r}

# Part 3a
# Compare mean lobster sizes at MPA vs. non-MPA sites in 2012 and 2018

MPA_v_nonMPA <- lobster_abundance %>% 
  mutate(site_status = 
           ifelse(site == "IVEE", "MPA",
         ifelse(site == "NAPL", "MPA", "non-MPA"))) %>% 
  select(size_mm, year, site, count, site_status) %>% 
  uncount(count) %>% 
  filter(year %in% c("2012", "2018"))

# ------------------------
# Make different datasets
# ------------------------

MPA <- lobster_abundance %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  filter(year %in% c("2012", "2018")) %>% 
  uncount(count)

MPA_2018 <- MPA %>% 
  filter(year %in% c("2018"))

MPA_2012 <- MPA %>% 
  filter(year %in% c("2012"))

non_MPA <- lobster_abundance %>% 
  filter(site %in% c("CARP", "MOHK", "AQUE")) %>% 
  filter(year %in% c("2012", "2018")) %>% 
  uncount(count)

non_MPA_2018 <- non_MPA %>% 
  filter(year %in% c("2018"))

non_MPA_2012 <- non_MPA %>% 
  filter(year %in% c("2012"))

# t-test questions

# 1. For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

diff_size_2012 <- t.test(MPA_2012$size_mm, non_MPA_2012$size_mm)

diff_size_2012

# 2. For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

diff_size_2018 <- t.test(MPA_2018$size_mm, non_MPA_2018$size_mm)

diff_size_2018

# 3. For MPA sites only, is there a significant difference in lobsters observed in 2012 vs. 2018?

diff_size_MPA <- t.test(MPA_2012$size_mm, MPA_2018$size_mm)

diff_size_MPA

# 4. For non-MPA sites only, is there a significant difference in lobsters observed in 2012 vs. 2018?

diff_size_non_MPA <- t.test(non_MPA_2012$size_mm, MPA_2018$size_mm)

diff_size_non_MPA

```

```{r}
# Part 3b

lobster_table_data <- MPA_v_nonMPA %>%
  uncount(count) %>% 
  group_by(site_status, year) %>% 
  summarize(mean = mean(size_mm),
            standard_deviation = sd(size_mm),
            sample_size = n()) %>% 
  mutate_if(is.numeric, round, 2)

lobster_table <- datatable(lobster_table_data,
                           caption = "MPA vs. Non-MPA") %>% 
  formatStyle('site_status', color = 'black') %>% 
  formatStyle('year', color = 'black') %>% 
  formatStyle('mean', color = 'black') %>%
  formatStyle('standard_deviation', color = 'black') %>% 
  formatStyle('sample_size', color = 'black')

lobster_table

# ------------------------------------------------------------------------------
# Spruce up caption for this table & email about fixing the color-scale of table
# ------------------------------------------------------------------------------

```

### A brief summary of the major findings (pick 3 - 4) from your mini-report. A bullet-pointed list is fine, but the findings should be well-written, responsible (donâ€™t overstate your findings), and refer to outcomes (e.g. figures, tables) in the Results section

### References (including for data sources & literature cited in your introduction) that were used to prepare the report. Reference formatting matters